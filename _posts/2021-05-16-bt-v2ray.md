---
title: 宝塔+V2ray，博客与V2RAY+Nginx+Ws+Tls共存。
author: fnoobt
date: 2021-05-16 15:04:00 +0800
categories: [VPS,V2ray]
tags: [v2ray,宝塔,vps,linux]
---


## 前言

V2ray+Nginx+Ws+Tls+WordPress是可以共存的。只要的VPS性能可以达到，这些要求实现起来也是不难，反倒是降低了V2ray的使用门槛，让配置只会更加的简单方便！

## 对于VPS的要求

如果VPS内存少于512M的就别再折腾了。搭建一个V2RAY+Ws+Tls就行了。别幻想其他！！！推荐1G内存（若你还打算安装SQL的话。）

## 准备好你的域名
可以使用免费的域名，也可以花几十注册特价域名，比如6~8位数字.xyz域名，有很多朋友们说CDN很鸡肋，也是，所以这期就直接使用你们域名提供商提供的DNS直接解析域名。（其实上期申请CDN仅仅只是为了做一个SSL证书而已，其实有很多地方可以申请SSL证书）

免费域名申请地址：[freenom](https://freenom.com) （若你是申请不了免费的，那么请移步下面）

收费申请地址：[namesilo](https://www.namesilo.com) (随便申请一个年付0.99/美元的域名，支付宝支付)

做好域名的解析，增加两个解析，一个泛解析，一个www的解析。有的域名提供商泛解析需要在主机名那里填入@，但是也有一些域名提供商主机名留空。

下面就开始VPS上面的操作

## 更改VPS系统时间（可选开启时间同步）

时间同步对于SSR也许无所谓，但是对于V2RAY很重要。是非常重要。下面的时间同步可以选择跳过，时间改好就可以了。

```bash
rm -rf /etc/localtime
ln -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
```

### NTP同步时间 协议（可选择跳过）

众所周知，NTP协议是网络时间同步协议，有了它，我们可以很轻松的同步本地时间与互联网时间。VPS上也可以使用NTP来同步网络。首先安装必要的软件包：

#### Ubuntu/Debian系统

```bash
apt-get update
apt-get install ntp ntpdate -y
```

#### CentOS/RHEL系统

```bash
yum install ntp ntpdate -y
```

#### 接下来我们需要先停止NTP服务器，再更新时间。

```bash
service ntpd stop                 #停止ntp服务
ntpdate us.pool.ntp.org           #同步ntp时间
service ntpd start                #启动ntp服务
```

执行完成后，VPS上就是相对精确的时间设置了。很多依赖于系统时间的应用程序也就能正常工作了。

## Debian安装宝塔面板

BT面板官方安装脚本：（Debian系统）

```bash
wget -O install.sh http://download.bt.cn/install/install-ubuntu_6.0.sh && bash install.sh
```

Centos安装

```bash
yum install -y wget && wget -O install.sh http://download.bt.cn/install/install_6.0.sh && sh install.sh
```

根据安装完成的地址和密码登录你的宝塔面板
安装Nginx/Sql/或是其他你需要的运行环境软件

因为有时候debian不能急速安装，一般是编译安装，所以速度慢的奇葩！！若是真心是建站需求的话，推荐使用CentOS 7以上的系统，那样安装运行环境很急速的！一般10分钟内全部搞定

## 开启Debian9 BBR

```bash
echo "net.core.default_qdisc=fq" >> /etc/sysctl.conf
echo "net.ipv4.tcp_congestion_control=bbr" >> /etc/sysctl.conf
sysctl -p
sysctl net.ipv4.tcp_available_congestion_control
lsmod | grep bbr
```

## 安装v2ray服务器：官方脚本

```bash
bash <(curl -L -s https://install.direct/go.sh)
```

如果提示 `curl: command not found` ，那是因为你的 VPS 没装 `Curl`

ubuntu/debian系统安装 Curl 方法

```bash
apt-get update -y && apt-get install curl -y 
```
centos系统安装 Curl 方法

```bash
yum update -y && yum install curl -y
```

`vi /etc/v2ray/config.json` V2RAY服务器的配置文件如下：（下面代码可以直接覆盖源文件代码）

```json
{
    "inbounds": [
    {
        "port": 1234,  //此处为v2ray的监控端口，可修改随意，但是保证和下面提到的端口号相同
        "listen":"127.0.0.1",
        "protocol": "vless",  //协议
        "settings": {
            "decryption": "none",
            "clients": [
            {
                "id": "XXXXXXX",  //用户ID
                "level": 1
            }
            ]
        },
        "streamSettings": {
            "network": "ws",
            "wsSettings": {
            "path": "/wspath"  //此处为路径，需要和下面NGINX上面的路径配置一样
            }
        }
    }
    ],
    "outbounds": [
    {
        "protocol": "freedom",
        "settings": {
            "domainStrategy": "UseIPv4"
        },
        "tag": "ipv4-out"
    },
    {
        //设置IPV6路由
        "protocol": "freedom",
        "settings": {
            "domainStrategy": "UseIPv6"
        },
        "tag": "ipv6_out"
    },
    {
        "protocol": "freedom",
        "settings": {},
        "tag": "default"
    }
    ],
    "routing": {
        "rules": [
        //访问netflix时启用IPV6路由
        {
            "type": "field",
            "outboundTag": "ipv6_out",
            "domain": [
                "domain:google.com",
                "geosite:netflix",
                "domain:eu.croxy.site"
            ]
        },
        {
            "type": "field",
            "outboundTag": "default",
            "ip": [
                "192.168.0.0/16"
            ]
        },
        {
            "type": "field",
            "outboundTag": "default",
            "network": "udp,tcp"
        }
        ]
    }
}
```

设置为开机自动启动

```bash
systemctl enable v2ray
```

启动v2ray服务

```bash
systemctl start v2ray
```

宝塔签发SSL证书，并强制开启HTTPS

配置站点的nginx

```bash
location /wspath { # 与 V2Ray 配置中的 path 保持一致
    proxy_redirect off;
    proxy_pass http://127.0.0.1:1234; #假设WebSocket监听在环回地址的1234端口上
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_set_header Host $http_host;
    }
```

****

> [原文出处](https://v2rayssr.com/v2raybaota.html)